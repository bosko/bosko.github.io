<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Pragmatic Development Notes]]></title>
  <link href="http://bosko.github.io/atom.xml" rel="self"/>
  <link href="http://bosko.github.io/"/>
  <updated>2013-08-03T21:24:42+02:00</updated>
  <id>http://bosko.github.io/</id>
  <author>
    <name><![CDATA[Boško Ivanišević]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Make Ruby Tests Greener]]></title>
    <link href="http://bosko.github.io/blog/2012/06/27/make-ruby-tests-greener/"/>
    <updated>2012-06-27T01:42:00+02:00</updated>
    <id>http://bosko.github.io/blog/2012/06/27/make-ruby-tests-greener</id>
    <content type="html"><![CDATA[<p><a href="https://groups.google.com/forum/?fromgroups#!topic/rubyinstaller/A92K_EYJX2A">The Ruby Greener Test Challenge</a> is here. It is attempt to make Ruby on Windows better and more stable and direct goal of this challenge is to fix all tests and to reach 0F0E (0 failures, 0 errors) state. If you are Ruby developer on Windows you should consider taking a role in the challenge.</p>

<p>If you decide to try to fix some failing tests or existing errors it is easy to set up complete environment with the help of <a href="http://cdn.rubyinstaller.org/archives/experimental/RubyChallengePack-v1.exe">Ruby Challenge Pack</a>. I will not write about details here since you have all you need in the initial challenge post given in the link on top of the article. Instead I will give you few suggestions about participating in the challenge.</p>

<p>You should be aware of three things when you run tests:</p>

<ol>
<li><strong>Set up console code page to 1252 or 65001.</strong> Some tests may fail due to the console code page, so before running tests you should execute <code>chcp 1252</code> or <code>chcp 65001</code>.</li>
<li><strong>Option -j2 may lead to errors.</strong> In case you want to run tests faster you can use <code>make test-al TESTS="-qv -j2"</code> but be aware that this can also lead to fals failures or errors.</li>
<li><strong>Anti-virus software.</strong> If you see <code>Errno::EACCES: Permission denied</code> error in test, most likely the cause is anti-virus which locked the file during tests.</li>
</ol>


<p>With these things on your mind you can proceed to fixing. Here is simple workflow you can use. The very first thing you should do is to clone Ruby source from GitHub:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone git://github.com/ruby/ruby.git
</span></code></pre></td></tr></table></div></figure>


<p>After deciding what you want to fix you should make new local branch in which you work:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git checkout -b fix-win32ole-fso-encoding-misuse
</span></code></pre></td></tr></table></div></figure>


<p>After you find a source of failures or errors you will make fixes and commit changes to your local branch. I would suggest making small commits. If commits contain too many changes, patches are harder to apply and are more likely to cause conflicts. Finally after finishing all fixes you just have to make a patch (es).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git checkout -b fix-win32ole-fso-encoding-misuse
</span></code></pre></td></tr></table></div></figure>


<p>Adjust last number in above command to the number of commits you made on your local branch. This will create one or more patch files (one file per commit). In the case of <a href="https://bugs.ruby-lang.org/issues/6650">already submitted fix</a> single file was created: <code>0001-FileSystemObject-does-not-support-UTF-8.patch</code>. At the end open a ticket, write small description, attach your patch file (s) and assign ticket to Luis Lavena.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Exefy ‘Em All]]></title>
    <link href="http://bosko.github.io/blog/2012/06/25/exefy-em-all/"/>
    <updated>2012-06-25T01:51:00+02:00</updated>
    <id>http://bosko.github.io/blog/2012/06/25/exefy-em-all</id>
    <content type="html"><![CDATA[<p>Recently Luis Lavena started thread <a href="https://groups.google.com/d/topic/rubyinstaller/fQCuPfiuuRc/discussion">Idea: executable stubs to replace batch files</a> on RubyInstaller mailing list. In short, the idea is to use command line applications &ndash; executable stubs &ndash; instead of batch files in RubyInstaller Ruby versions. Using command line applications instead of batch files has several benefits. First one, maybe not so important, is to avoid annoying</p>

<p>Terminate batch job (Y/N)?</p>

<p>question when execution is interrupted with Ctrl-C key combination. The second is to get meaningful list of processes in the system. With batch files we can only see bunch of ruby.exe processes in the list. This gives us possibility to define firewall rules for these applications which will not be applied globally for all Ruby scripts. Finally, installing Ruby applications as services, with the help of some service wrapper, is usually easier if we use executable file. These are reasons why new <a href="http://github.com/bosko/gem-exefy">gem-exefy</a> gem was made.</p>

<h3>Gem-exefy Internals</h3>

<p>Gem-exefy mimics behavior of batch files installed by RubyGems and to see how it works we must know how existing batch files work. First step is to install gem that has executable value defined in gem specification. Example of such gem is Bundler. After installing it on Windows, RubyGems will create bundle.bat file in <code>&lt;path_to_ruby_installation&gt;/bin</code> folder. Content of that file is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">ECHO</span> <span class="k">OFF</span>
</span><span class='line'><span class="k">IF</span> NOT <span class="s2">&quot;%~f0&quot;</span> <span class="o">==</span> <span class="s2">&quot;~f0&quot;</span> <span class="k">GOTO</span> <span class="nl">:WinNT</span>
</span><span class='line'><span class="p">@</span><span class="s2">&quot;ruby.exe&quot;</span> <span class="s2">&quot;c:/path/to/ruby/installation/bin/bundle&quot;</span> <span class="nv">%1</span> <span class="nv">%2</span> <span class="nv">%3</span> <span class="nv">%4</span> <span class="nv">%5</span> <span class="nv">%6</span> <span class="nv">%7</span> <span class="nv">%8</span> <span class="nv">%9</span>
</span><span class='line'><span class="k">GOTO</span> <span class="nl">:EOF</span>
</span><span class='line'><span class="nl">:WinNT</span>
</span><span class='line'><span class="p">@</span><span class="s2">&quot;ruby.exe&quot;</span> <span class="s2">&quot;%~dpn0&quot;</span> %*
</span></code></pre></td></tr></table></div></figure>


<p>Without digging too much into all details we can see that batch file starts ruby.exe passing it full path to Ruby script (bundle, in this case) using all arguments passed to batch file as arguments of Ruby script. So all we have to do is to make application which will be able to execute Ruby script and will accept arguments passed in the command line. Sounds familiar, isn’t it? Exactly! We already have ruby.exe and in Ruby code we can find almost everything we need. Here is a slightly simplified version of Ruby’s main.c file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &quot;ruby.h&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#ifdef HAVE_LOCALE_H</span>
</span><span class='line'><span class="cp">#include &lt;locale.h&gt;</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span>
</span><span class='line'><span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="cp">#ifdef HAVE_LOCALE_H</span>
</span><span class='line'>  <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="cp">#endif</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ruby_sysinit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">RUBY_INIT_STACK</span><span class="p">;</span>
</span><span class='line'>    <span class="n">ruby_init</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">ruby_run_node</span><span class="p">(</span><span class="n">ruby_options</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we build application from this source we will get the same application as ruby.exe. This means if we want to execute some Ruby script we will have to pass path to it as a first argument with optional arguments following it. But our goal is not to invoke application with the path to Ruby script. Instead we want to invoke predefined script. In order to achieve that, we obviously have to alter the list of arguments (argv) and to insert path to target Ruby script. But there is a catch (I spent almost whole day to figure it out). We must change the list of arguments after the call</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">ruby_sysinit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ruby performs system dependent arguments initialization in the above method and the list of arguments will be reverted back if we change it before this initialization. Of course there are some additional details that we must take care of, but you can figure them out directly from &ldquo;the source&rdquo;:<a href="https://github.com/bosko/gem-exefy/blob/master/templates/gem_exe.c.">https://github.com/bosko/gem-exefy/blob/master/templates/gem_exe.c.</a> After we change the list of arguments, Ruby will execute script we passed it and that’s all the magic gem-exefy does.</p>

<h3>Let’s Exefy</h3>

<p>We are now ready to exefy existing and new gems on our RubyInstaller version. gem-exefy is made as RubyGems plugin. After installing it with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install gem-exefy
</span></code></pre></td></tr></table></div></figure>


<p>new gem command will be available &ndash; exefy. This command is used for replacing batch files for single or all installed gems. Replacing batch files with executable stubs for single gem is performed by passing name of the targeted gem to the exefy command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem exefy bundler
</span></code></pre></td></tr></table></div></figure>


<p>Exefying all installed gems is simple &ndash; just pass <code>--all</code> to <code>exefy</code> command</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem exefy --all
</span></code></pre></td></tr></table></div></figure>


<p>If you are not satisfied and still want to use batch files &ndash; don’t worry. You can always revert old batch files for single or all gems with <code>--revert</code> argument</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem exefy bundler --revert
</span><span class='line'>gem exefy --all --revert
</span></code></pre></td></tr></table></div></figure>


<p>After gem-exefy is installed it will, by default, install executable stubs instead of batch files for all gems installed after it.</p>

<p>It is important to mention that gem-exefy will not replace batch files for commands installed with RubyInstaller (irb, rake&hellip;) and are part of Ruby core. Will support for converting these batch files be implemented is yet to be seen.</p>

<h3>Acknowledgements</h3>

<p>I want to thanks <a href="https://github.com/luislavena">@luislavena</a>,<a href="https://github.com/azolo">@azolo</a> and <a href="https://github.com/jonforums">@jonforums</a> for helping me out making gem-exefy.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby on Windows Guides - The Book]]></title>
    <link href="http://bosko.github.io/blog/2012/03/07/ruby-on-windows-guides-the-book/"/>
    <updated>2012-03-07T20:02:00+01:00</updated>
    <id>http://bosko.github.io/blog/2012/03/07/ruby-on-windows-guides-the-book</id>
    <content type="html"><![CDATA[<p>I use Windows on my everyday work. First thing I do after installing Windows is to set up complete environment for Ruby. In “ancient” days (measuring in computer years, of course) I have used One Click Installer. Later, <a href="http://www.rubyinstaller.org">RubyInstaller</a> came on the scene.</p>

<p>With much better foundations, RubyInstaller simplified Ruby usage and made it look like on Linux, Ruby’s native platform. Key benefit of RubyInstaller over One Click installer was possibility to install Ruby native gems written in C. Switching from commercial VisualStudio, used in One Click Installer, to MinGW build tool-chain in RubyInstaller was crucial decision made by Luis Lavena, great author of RubyInstaller.</p>

<p>After RubyInstaller, one more project appeared with the goal to simplify Ruby on Rails installation and usage on Windows. RailsInstaller. I haven’t tried it, but I’m sure it will help increasing number of Rails users on Windows.</p>

<p>But do you really need installer for Ruby on Rails on Windows? It depends of your attitude. If you are not interested what is going on behind the scenes and just want to be able to start using Rails after few mouse clicks RailsInstaller is definitely for you.</p>

<p>If, on the other hand, you want to know how things work, you should try to install Ruby on Rails without installer. With RubyInstaller installing Ruby on Rails on Windows is, actually, just a matter of issuing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install rails
</span><span class='line'>gem install sqlite3
</span></code></pre></td></tr></table></div></figure>


<p>Of course you might face problems building and installing some gems, primarily because gem authors don’t want to bother with Windows support or simply because gems rely of third party libraries that are not ported to Windows. In any case you can ask for help on <a href="http://groups.google.com/group/rubyinstaller">RubyInstaller mailing list</a>.</p>

<p>People wonder if Ruby and Ruby on Rails are really usable on Windows. My opinion is that they are. Of course, there are some problems mainly with speed, but I would dare to say that solutions are on the way and hopefully very soon this will not be problem any more. I guess main reason why they are not so widespread on Windows platforms is scepticism and lack of experience.</p>

<p>As one of contributors to RubyInstaller project I noticed same questions are repeated on RubyInstaller mailing list. Mainly because of lack of familiarity with Ruby and RoR on Windows. That’s why I decided to write <a href="http://rubyonwindowsguides.github.com">a book</a> where I tried to give deeper insight on all details about installing and using Ruby and Ruby on Rails on Windows. The <a href="http://rubyonwindowsguides.github.io">Ruby on Windows Guides</a> is still in beta. However it already covers the most important issues and I think all novices and advanced developers can learn something new from it. Work on the book is still in progress so if you have any suggestions, ideas and wishes you can send them as an <a href="https://github.com/rubyonwindowsguides/rubyonwindowsguides.github.com/issues">issue on the GitHub</a>.</p>

<p>If you want to get deeper understanding of Ruby and Ruby on Rails on Windows, find out how to build native gems in several ways or just want to get an idea for what you can use Ruby on Windows go ahead and read the book. Of course I expect your comments, here or on GitHub.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[dep_walker Gem]]></title>
    <link href="http://bosko.github.io/blog/2011/05/07/dep-walker-gem/"/>
    <updated>2011-05-07T06:40:00+02:00</updated>
    <id>http://bosko.github.io/blog/2011/05/07/dep-walker-gem</id>
    <content type="html"><![CDATA[<p>Common problem that Ruby developers face on Windows is missing dll message box that appears when they try to use gem that has extension library. Usually these Gems are packed with pre-built binary\ extensions for windows and, even though, installation passes without any error or warning, when they try to use them they realize that dll these Gems depend on are missing on the system.</p>

<p>Maybe most common Gem for which this happens is sqlite3, Ruby binding for the SQlite3 embedded database. If sqlite3.dll is missing from the system, after installation of sqlite3 Gem any attempt to use it causes following message box to appear.</p>

<p><img src="http://bosko.github.io/images/dep_walker/missing_dll_msg_box.png" title="Missing DLL message box." ></p>

<p>If two versions of a required dll exist on the system Gem might use the wrong one and strange crashes can appear.</p>

<p>These errors are not limited to the Gems that have pre-built binary extensions but can also happen if extension library was built with the <a href="http://www.rubyinstaller.org">RubyInstaller’s</a> <a href="http://www.rubyinstaller.org/add-ons/devkit">DevKit</a>. If development files (header and library files) needed for the extension library to be built exist on the system while target dll is missing gem usage\ will cause the same message box to appear.</p>

<p>Frequently novice Ruby users on Windows ask question on mailing lists why Gem is not working even if it was installed without any error. That’s why I made dep_walker, small utility Gem, that can be used to check whether all dependencies for extension libraries used by installed Gem (s) are met or not. Source of the Gem can be found on <a href="http://github.com/bosko/dep_walker">GitHub</a>.</p>

<p>Usage is very simple. If you want to check all installed Gems just invoke dep_walker with the ’-a’ switch.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>dep_walker -a
</span></code></pre></td></tr></table></div></figure>


<p>And for particular gem swith <code>-c</code> can be used.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>dep_walker -c sqlite3
</span></code></pre></td></tr></table></div></figure>


<p>More verbose output is obtained via <code>-t</code> and colour with <code>--color</code> swith. Happy dependencies walking!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Selenium with Cucumber through Webrat or Capybara. Which one to choose?]]></title>
    <link href="http://bosko.github.io/blog/2010/10/31/using-selenium-with-cucumber-through-webrat-or-capybara-which-one-to-choose/"/>
    <updated>2010-10-31T13:55:00+01:00</updated>
    <id>http://bosko.github.io/blog/2010/10/31/using-selenium-with-cucumber-through-webrat-or-capybara-which-one-to-choose</id>
    <content type="html"><![CDATA[<h2>Introduction</h2>

<p>Testing is (or should be) important part of every software development. Over time various testing strategies and supporting tools and frameworks have been developed. Regarding Web development biggest advance has been made in Behavior Driven Development. Consequently many tools for BDD are published and used.</p>

<p><a href="http://www.rubyonrails.org">Ruby on Rails</a> framework had great built-in support for testing from the very beginning. As it usually happens, lot of specialised testing tools appeared aside of it and among all of them my favourites are <a href="http://rspec.info">RSpec</a> and <a href="http://github.com/aslakhellesoy/cucumber/wiki">Cucumber</a>. The first one for unit and the second for functional tests. Both of them are well integrated with Ruby on Rails and are very easy to set up and start with. Moreover there is no need to use real browsers which results in fast tests execution. Perfect way for BDD.</p>

<p>But what if you have to perform functional tests on non Ruby on Rails applications or your application relies heavily on JavaScript (no matter in which framework it is written)? Luckily Cucumber can be used in that case too. Since Cucumber supports Rails out of the box there is basically no need for some special configuration. On the other hand if a real browser must be used in tests, or functional testing must be done outside of the Rails environment setting up Cucumber can be little tricky but still simple enough. In this article I will focus on this scenario &ndash; <em>testing non Rails applications with <a href="http://github.com/aslakhellesoy/cucumber/wiki">Cucumber</a> and <a href="http://seleniumhq.org">Selenium</a></em>.</p>

<p>Using Selenium in Cucumber tests is done through <a href="http://github.com/brynary/webrat/wiki">Webrat</a> or <a href="http://github.com/jnicklas/capybara">Capybara</a>. First we must set up complete environment, and in the first step all necessary gems must be installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">launchy</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">rspec</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">cucumber</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">webrat</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">capybara</span> <span class="o">--</span><span class="n">pre</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">selenium</span><span class="o">-</span><span class="n">client</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">selenium</span><span class="o">-</span><span class="n">webdriver</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Option —pre is used to install Capybara 0.4.0 rc</em></p>

<p><strong>Important notice for MS Windows users: Webrat depends on Json gem which installs binaries compiled against <a href="http://www.rubyinstaller.org">Rubyinstaller</a> Ruby 1.8.x version. If you are using 1.9.2 Ruby you must uninstall Json gem and install it again but with <code>--platform=ruby</code> option:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">uninstall</span> <span class="n">json</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">json</span> <span class="o">--</span><span class="n">platform</span><span class="o">=</span><span class="n">ruby</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since article focuses on the functional testing outside of Rails we should manually create folder structure that Cucumber expects.</p>

<pre><code>tests
 |- features
     |- support
     |- step_definitions
</code></pre>

<p>All <code>.feature</code> files go in the <code>features</code> folder. In the <code>support</code> folder <code>env.rb</code> file should be created and within it all set up must be made. Finally steps are implemented in Ruby files in <code>step_definitions</code> folder.</p>

<h2>Webrat</h2>

<p><a href="http://github.com/brynary/webrat/wiki">Webrat</a> controls Selenium through Selenium RC (remote control) and selenium-client gem. In order to use Selenium through Webrat put following code in your <code>env.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;cucumber/formatter/unicode&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;webrat&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;webrat/core/matchers&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Webrat</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="ss">:selenium</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">application_framework</span> <span class="o">=</span> <span class="ss">:external</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">selenium_server_address</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span class='line'>    <span class="k">if</span> <span class="ss">RbConfig</span><span class="p">:</span><span class="ss">:CONFIG</span><span class="o">[</span><span class="s1">&#39;host_os&#39;</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/mingw|mswin/</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">selenium_browser_startup_timeout</span> <span class="o">=</span> <span class="mi">60</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">application_address</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">application_port</span> <span class="o">=</span> <span class="s1">&#39;3000&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">World</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">session</span> <span class="o">=</span> <span class="ss">Webrat</span><span class="p">:</span><span class="ss">:Session</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="n">session</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="ss">Webrat</span><span class="p">:</span><span class="ss">:Methods</span><span class="p">)</span>
</span><span class='line'>  <span class="n">session</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="ss">Webrat</span><span class="p">:</span><span class="ss">:Selenium</span><span class="o">::</span><span class="no">Methods</span><span class="p">)</span>
</span><span class='line'>  <span class="n">session</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="ss">Webrat</span><span class="p">:</span><span class="ss">:Selenium</span><span class="o">::</span><span class="no">Matchers</span><span class="p">)</span>
</span><span class='line'>  <span class="n">session</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That’s all if you are running Linux based system. On Windows a little bit more effort must be made. First of all, Webrat usess 0.0.0.0 IP address when it starts Selenium and MS Windows does not like it at all. Secondly it uses <code>/dev/null</code> stream which is not available on MS Windows. Patch is already submitted and you can follow a ticket at <a href="https://webrat.lighthouseapp.com/projects/10503/tickets/387-tiny-patch-for-work-with-selenium-on-windows#ticket-387-2">Webrat Lighthouse</a>. But until fix is accepted and new version is released, you can take a patch from <a href="http://gist.github.com/584005">Github gitst</a> and apply it to Webrat sources.</p>

<div><script src='https://gist.github.com/584005.js'></script>
<noscript><pre><code></code></pre></noscript></div>


<p>Besides this patch few more things must be done. Line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">selenium_server_address</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span> <span class="k">if</span> <span class="ss">RbConfig</span><span class="p">:</span><span class="ss">:CONFIG</span><span class="o">[</span><span class="s1">&#39;host_os&#39;</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/mingw|mswin/</span>
</span></code></pre></td></tr></table></div></figure>


<p>must be added to the <code>config</code> block as is already shown in the above snippet. Unfortunately selenium-client gem does not recognize <a href="http://www.rubyinstaller.org">Rubyinstaller</a> since it is built using MinGW tools. Therefore one more tiny patch must be made in the <code>selenium-client-1.2.18/lib/nautilus/shell.rb</code> file. Function <code>windows?</code> must be replaced with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">windows?</span>
</span><span class='line'>  <span class="o">::</span><span class="ss">RbConfig</span><span class="p">:</span><span class="ss">:CONFIG</span><span class="o">[</span><span class="s1">&#39;host_os&#39;</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/mswin|mingw/</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You are ready for application testing. By default Selenium will use Firefox and if you want to use other browser (in the example Internet Explorer is set) add following line to <code>config</code> block:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">selenium_browser_key</span> <span class="o">=</span> <span class="s1">&#39;*iexplore&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Capybara</h2>

<p>Although <a href="http://github.com/jnicklas/capybara">Capybara</a> can use Selenium RC, it primarily uses Selenium WebDriver which is still in beta phase but is working good. Since we already installed all necessary gems we can go on with configuring our testing environment. File <code>env.rb</code> should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rbconfig&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;cucumber/formatter/unicode&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara/dsl&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;capybara/cucumber&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">default_driver</span> <span class="o">=</span> <span class="ss">:selenium</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">app_host</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:8000/&quot;</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">register_driver</span> <span class="ss">:selenium</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
</span><span class='line'>  <span class="ss">Capybara</span><span class="p">:</span><span class="ss">:Driver</span><span class="o">::</span><span class="no">Selenium</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="ss">:browser</span> <span class="o">=&gt;</span> <span class="ss">:firefox</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">World</span><span class="p">(</span><span class="no">Capybara</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Setting up Capybara is definitely much easier. But on MS Windows systems, if you want to use Internet Explorer, you still have to patch sources. Authors are already <a href="http://groups.google.com/group/webdriver/browse_thread/thread/a8ed4ce6f98e8322">notified about required patch</a> and I believe that new version of <code>selenium-webdriver</code> gem will be released with it. In the meantime you just have to change definition of <code>initialize</code> method in <code>selenium-webdriver-0.0.28/lib/selenium/webdriver/ie/bridge.rb</code> from:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">initialize</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>to</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">opts</span> <span class="o">=</span> <span class="p">{})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Changing browser is as easy as changing <code>:firefox</code> to <code>:ie</code> or <code>:chrome</code>. Instead of <code>:firefox</code> you can also use <code>:ff</code> and for Internet Explorer <code>:internet_explorer</code>. One more notice about differences if you are switching from Webrat to Capybara. Capybara will reset session after each step. If you do not want that (for example you log in to your application in the first scenario, and do not want to repeat it in each succeeding one) just add:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">After</span> <span class="k">do</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>in <code>env.rb</code> file.</p>

<p>With Capybara you are not limited to Selenium WebDriver. If you want to use Selenium RC you just need to configure it in <code>env.rb</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rbconfig&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;cucumber/formatter/unicode&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;capybara/dsl&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;capybara/cucumber&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">default_driver</span> <span class="o">=</span> <span class="ss">:selenium</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">app_host</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:9000/&quot;</span>
</span><span class='line'><span class="no">Capybara</span><span class="o">.</span><span class="n">register_driver</span> <span class="ss">:selenium</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># This way we are using Selenium-RC</span>
</span><span class='line'>  <span class="ss">Capybara</span><span class="p">:</span><span class="ss">:Driver</span><span class="o">::</span><span class="no">Selenium</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">app</span><span class="p">,</span>
</span><span class='line'>                                 <span class="ss">:browser</span> <span class="o">=&gt;</span> <span class="ss">:remote</span><span class="p">,</span>
</span><span class='line'>                                 <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">&quot;http://127.0.0.1:4444/wd/hub&quot;</span><span class="p">,</span>
</span><span class='line'>                                 <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="ss">:internet_explorer</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">World</span><span class="p">(</span><span class="no">Capybara</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>Both gems for running Selenium as a base for functional tests &ndash; Webrat and Capybara are easy to use. Although Webrat needs more patching to work under Windows it has one advantage. It can be used with <a href="http://mechanize.rubyforge.org/mechanize/">Mechanize</a> if you do not need real browser and you still want to test non Rails application. But as much as it is advantage for “classic” Web application Mechanize cannot interpret JavaScript. So if you want to include JavaScript testing you either have to use real browser or switch to Capybara.</p>

<p>Capybara, on the other hand, needs significantly less patching on MS Windows systems and it cannot use Mechanize as far as I know. But, from my point of view, it is easier to use then Webrat. Currently it cannot use Mechanize, but it can use <a href="http://github.com/langalex/culerity/">Culerity</a> and <a href="http://celerity.rubyforge.org/">Celerity</a> for JavaScript testing. Moreover <a href="http://github.com/smparkes/capybara-envjs">capybara-envjs driver</a> can be used to interpret JavaScript outside of the browser.</p>

<p>Although I’m still not sure which one is better to use, I switched from Webrat to Capybara and I think that tests that use Selenium WebDriver are running faster. There is an <a href="http://groups.google.com/group/ruby-capybara/browse_thread/thread/4bcc26a9cfa20ef2">initiative for merging</a> these projects into one but I do not know if it will happen and when. I would like to hear what you think. What is your choice: Webrat or Capybara?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ActiveRecord SchemaDumper and MySQL problem]]></title>
    <link href="http://bosko.github.io/blog/2010/10/03/activerecord-schemadumper-and-mysql-problem/"/>
    <updated>2010-10-03T20:31:00+02:00</updated>
    <id>http://bosko.github.io/blog/2010/10/03/activerecord-schemadumper-and-mysql-problem</id>
    <content type="html"><![CDATA[<p>After finishing first version of <a href="http://github.com/bosko/rmre">Rmre</a> and issuing fix gem dependency in version 0.0.2, I got an idea for additional functionality. Why not use Rmre for dumping complete schema with all foreign keys data? What would be possible scenario for using this, one might ask? We have possibility to create ActiveRecord models in order to move to Ruby on Rails where main premise is to keep logic out of database and maintain it in application. Therefore we do not need foreign keys since we already have constraints defined in models.</p>

<p>But what if you cannot move to Ruby on Rails and you only have to change DBE, i.e. instead of MS SQL you must use Oracle? In that case you still have to work with legacy database from PHP or Hibernate in Java and “<em>only</em>” thing you have to do is to make create script for all tables but for another DBE. When database has hundreds of tables with lots of relations this can turn into nightmare, especially if you have to maintain both versions.</p>

<p>Rmre should simplify this. First you use Rmre to dump schema to some file and later you can use ActiveRecord’s capabilities to load it on different DBE. Since loading schema in ActiveRecord is DBE agnostic it should correctly create tables, indices and foreign keys on any database engine. That’s theory and, as usual, practice is a little bit different. On a very first step I’ve faced problem in MySQL database.</p>

<p>Let’s examine database with just a two tables &ndash; <code>city</code> and <code>country</code>. Create script would look like (example from <a href="http://dev.mysql.com/doc/sakila/en/sakila.html">Sakila</a> database):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">city</span> <span class="p">(</span>
</span><span class='line'>  <span class="n">city_id</span> <span class="nb">SMALLINT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
</span><span class='line'>  <span class="n">city</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="n">country_id</span> <span class="nb">SMALLINT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="n">last_update</span> <span class="k">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span>
</span><span class='line'>    <span class="k">CURRENT_TIMESTAMP</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
</span><span class='line'>  <span class="k">PRIMARY</span> <span class="k">KEY</span>  <span class="p">(</span><span class="n">city_id</span><span class="p">),</span>
</span><span class='line'>  <span class="k">KEY</span> <span class="n">idx_fk_country_id</span> <span class="p">(</span><span class="n">country_id</span><span class="p">),</span>
</span><span class='line'>  <span class="k">CONSTRAINT</span> <span class="o">`</span><span class="n">fk_city_country</span><span class="o">`</span>
</span><span class='line'>    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">country_id</span><span class="p">)</span>
</span><span class='line'>    <span class="k">REFERENCES</span> <span class="n">country</span> <span class="p">(</span><span class="n">country_id</span><span class="p">)</span>
</span><span class='line'>    <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
</span><span class='line'><span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">country</span> <span class="p">(</span>
</span><span class='line'>  <span class="n">country_id</span> <span class="nb">SMALLINT</span> <span class="n">UNSIGNED</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
</span><span class='line'>  <span class="n">country</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="n">last_update</span> <span class="k">TIMESTAMP</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>
</span><span class='line'>    <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
</span><span class='line'>  <span class="k">PRIMARY</span> <span class="k">KEY</span>  <span class="p">(</span><span class="n">country_id</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As can be seen from above script table <code>city</code> has foreign key on table <code>country</code>. Now let’s see what is result of a dump:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="ss">:version</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">create_table</span> <span class="s2">&quot;actor&quot;</span><span class="p">,</span> <span class="ss">:primary_key</span> <span class="o">=&gt;</span> <span class="s2">&quot;actor_id&quot;</span><span class="p">,</span> <span class="ss">:force</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">create_table</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="ss">:primary_key</span> <span class="o">=&gt;</span> <span class="s2">&quot;city_id&quot;</span><span class="p">,</span> <span class="ss">:force</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">string</span>    <span class="s2">&quot;city&quot;</span><span class="p">,</span>        <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">integer</span>   <span class="s2">&quot;country_id&quot;</span><span class="p">,</span>  <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>  <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">timestamp</span> <span class="s2">&quot;last_update&quot;</span><span class="p">,</span>               <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">add_index</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;country_id&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;idx_fk_country_id&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">create_table</span> <span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="ss">:primary_key</span> <span class="o">=&gt;</span> <span class="s2">&quot;country_id&quot;</span><span class="p">,</span> <span class="ss">:force</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">string</span>    <span class="s2">&quot;country&quot;</span><span class="p">,</span>     <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">timestamp</span> <span class="s2">&quot;last_update&quot;</span><span class="p">,</span>               <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">execute</span> <span class="s2">&quot;ALTER TABLE city ADD CONSTRAINT fk_city_country FOREIGN KEY (country_id) REFERENCES country(country_id)&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At the first glance this looks good but unfortunately doesn’t work. Problem is that loading this schema through ActiveRecord will create columns <code>city_id</code> in table <code>city</code> and <code>country_id</code> in table <code>country</code> as <code>integer</code> type but column <code>country_id</code> in table <code>city</code> is created as <code>smallint</code>. Defining constraint on columns which are not of same type is not allowed so last statement for altering table fails. At the moment I have no idea how to fix this and any suggestion is very welcome. I still have to check what happens on other DBEs: PostgreSQL, Oracle and MS SQL.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RMRE - rails models reverse engineering gem]]></title>
    <link href="http://bosko.github.io/blog/2010/09/30/rmre-rails-models-reverse-engineering-gem/"/>
    <updated>2010-09-30T13:50:00+02:00</updated>
    <id>http://bosko.github.io/blog/2010/09/30/rmre-rails-models-reverse-engineering-gem</id>
    <content type="html"><![CDATA[<p>Very often I have to work on databases which do not follow ActiveRecord convention and making ActiveRecord models, if number of tables is large, is very slow and boring task. In order to speed up and simplify it I’ve created <a href="http://github.com/bosko/rmre">Rmre gem</a>. Gem is quite simple yet you might find it useful if you want to create fixtures, migrations or simply port application to Ruby on Rails.</p>

<p>So how it works? For each table in the database, gem creates model. Name of the model is created using Rails <code>classify</code> method. Moreover, if table’s primary key is not column named “id” gem sets primary key by adding <code>set_primary_key "primaryKeyColumnName"</code> line to the model. In addition for MySQL, PostgreSQL, Oracle or MS SQL foreign keys are analyzed and for each constraint gem generates <code>belongs_to</code> or <code>has_many</code> lines. Here is model created for table <em>store</em> in <a href="http://dev.mysql.com/doc/sakila/en/sakila.html">Sakila</a> MySQL test database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Store</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">set_primary_key</span> <span class="ss">:store_id</span>
</span><span class='line'>  <span class="n">set_table_name</span> <span class="s1">&#39;store&#39;</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:customers</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Customer&#39;</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:inventories</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Inventory&#39;</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:staffs</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Staff&#39;</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:address</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Addres&#39;</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="ss">:address_id</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:staff</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Staff&#39;</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="ss">:manager_staff_id</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby 1.9.2 on Windows - coming soon]]></title>
    <link href="http://bosko.github.io/blog/2010/08/19/ruby-1-9-2-on-windows-coming-soon/"/>
    <updated>2010-08-19T22:33:00+02:00</updated>
    <id>http://bosko.github.io/blog/2010/08/19/ruby-1-9-2-on-windows-coming-soon</id>
    <content type="html"><![CDATA[<p>I guess all Ruby and Windows users will be happy to hear that <a href="http://rubyinstaller.org/">RubyInstaller</a> team is about to release Ruby 1.9.2p0 very soon. See details in <a href="http://groups.google.com/group/rubyinstaller/browse_thread/thread/a9b1149f9ee77a72">this thread</a>. It will take some time to update documentation so be patient and keep an eye on the project home page.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Upgrade to Lucid Lynx problems]]></title>
    <link href="http://bosko.github.io/blog/2010/05/16/upgrade-to-lucid-lynx-problems/"/>
    <updated>2010-05-16T10:41:00+02:00</updated>
    <id>http://bosko.github.io/blog/2010/05/16/upgrade-to-lucid-lynx-problems</id>
    <content type="html"><![CDATA[<p>After several successful updates of Ubuntu (starting from 8.10) last one was, more or less, complete mess. I was waiting impatiently for new Lucid Lynx to be released and started update as soon as I downloaded and burned DVD iso image. It seems everything goes smoothly till first reboot. Emacs was completely removed and new version was not installed. On my Compaq 8710w laptop with Quadro FX 1600M graphics card splash screen was displayed in low resolution and looked quite ugly. Moreover I was not able to install Emacs again.</p>

<p>I’ve decided to reinstall everything, so I’ve made backup of my home folder and start installation on a newly formatted partitions. Situation was a little bit better. I was able to install Emacs and all applications I need but problem with graphics card was still there as well as lousy splash screen. I’ve found few suggestions how to fix that by altering grub files and it really solved resolution problem but, at the same time, whole splash screen was shifted left and basically I was again on the beginning.</p>

<p>There is one more thing that annoyed me. I like Shere Khan Black Hand mouse pointers so I’ve installed that theme, but arrow pointer was still white, although some other pointers were changed (hand is small and black). Whatever I’ve tried arrow was keep staying white.</p>

<p>Then, after a few days, I saw black arrow and was really surprised. It turned out that it was unpleasant surprise because compiz stopped working and Nvidia driver was not enabled. Obviously it was time to try latest Nvidia drivers so I’ve downloaded and installed them. I must say that situation is now a little bit better &ndash; compiz is working, but I still have no luck with mouse pointers, nor with splash screen.</p>

<p>If Canonical’s goal is to increase number of Ubuntu users, they should really try to avoid such problems, since average user will certainly not be able to fix them and will switch to some other operating system.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby, Rails and MS SQL server]]></title>
    <link href="http://bosko.github.io/blog/2010/02/18/ruby-rails-and-ms-sql-server/"/>
    <updated>2010-02-18T22:34:00+01:00</updated>
    <id>http://bosko.github.io/blog/2010/02/18/ruby-rails-and-ms-sql-server</id>
    <content type="html"><![CDATA[<p>Setting up Rails and Ruby to use MS SQL server was always painful task. Fortunately things have changed &ndash; a lot! With new <a href="http://github.com/rails-sqlserver/2000-2005-adapter">Rails SQL Server 2000, 2005 and 2008 Adapter</a> and Christian Werner’s <a href="http://www.ch-werner.de/rubyodbc">ruby-odbc gem</a> you can do it in a few minutes.</p>

<p>If you want to use these gems on Windows grab Ruby installation from <a href="http://www.rubyinstaller.org">RubyInstaller</a> site and be sure to install <a href="http://rubyforge.org/frs/download.php/66888/devkit-3.4.5r3-20091110.7z">DevKit</a> prior to installing ruby-odbc.</p>

<p>Versions of ruby-odbc before 0.9999 do not work on mingw based (RubyInstaller) Ruby. Luckily author was very fast and made new version very quickly after I sent him a patch. Thanks Christian!</p>

<p>Both gems work well on Ruby 1.8.6 and 1.9.1 Ruby versions on Windows with old ActiveRecords, but I hope rails adapter will be ported to ActiveRecords 3 soon.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RStreamTuner in action]]></title>
    <link href="http://bosko.github.io/blog/2010/01/26/rstreamtuner-in-action/"/>
    <updated>2010-01-26T19:00:00+01:00</updated>
    <id>http://bosko.github.io/blog/2010/01/26/rstreamtuner-in-action</id>
    <content type="html"><![CDATA[<p>Friend of mine criticised me why I didn’t put some screenshots on <a href="http://github.com/bosko/rstreamtuner">project page</a>. Since I couldn’t find a way to do it there I’ve decided to put some screenshots here, so
here they are.</p>

<p><img src="http://bosko.github.io/images/rst-screenshots/rst_xiph.png" title="RST Xiph plugin." >
<img src="http://bosko.github.io/images/rst-screenshots/rst_search.png" title="RST SHOUTcast search in action" >
<img src="http://bosko.github.io/images/rst-screenshots/rst_preferences.png" title="RST plugin preferences." ></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RStreamTuner - new streaming directories browser]]></title>
    <link href="http://bosko.github.io/blog/2010/01/22/rstreamtuner-new-streaming-directories-browser/"/>
    <updated>2010-01-22T19:00:00+01:00</updated>
    <id>http://bosko.github.io/blog/2010/01/22/rstreamtuner-new-streaming-directories-browser</id>
    <content type="html"><![CDATA[<p>I like to listen various Internet radio stations while I work. My favourite application was
<a href="http://www.nongnu.org/streamtuner">streamtuner</a> mostly because it had support for SHOUTcast. Unluckily new SHOUTcast design cannot be handled by <strong>streamtuner</strong> and future development on this application is
stopped. In other words there is a little chance for streamtuner to be upgraded so I’ve decided to make my own streaming directories browser &ndash; <a href="http://github.com/bosko/rstreamtuner">RStreamTuner (Ruby Stream Tuner)</a>.</p>

<p>As usual developing in Ruby was real pleasure and only doubt was what to use for GUI part. I’ve started with Ruby/Tk and left it very quickly due to very poor documentation (and probably lack of Tcl knowledge). I had
to find replacement and my primary goal was to find library that works equally well on Linux and Windows. WxWidgets with WxRuby gem was my final choice. Although <strong>RStreamTuner</strong> is still in early development
phase it is quite usable. At the moment it supports SHOUTcast and Xiph directories, but I plan to add more as soon as I find good one. Good candidate could be Live365 but they’ve made their pages quite hard to
parse so I’ll probably leave it for later.</p>

<p>Once I reach beta version, making support for new streaming directories will be quite easy and will require implementation of just a few methods. As a matter of act it is already so simple but I’m not
satisfied with the code and will change it once I find a little bit more time. Code is quite rough (I had little time to make <strong>RStreamTuner</strong> and was eager to get working version as soon as possible). Besides I
want to write detailed instructions how to add support for new directories. Anyway if you like to listen Internet radion stations and like Ruby clone <a href="http://github.com/bosko/rstreamtuner">RStreamTuner</a>. Of
course if you have suggestions do not hasitate to drop me a note and if you make support for new streaming directory just send me a pull request and I’ll try to grab it as soon as possible.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Still on CVS? Too Bad!]]></title>
    <link href="http://bosko.github.io/blog/2009/06/05/still-on-cvs-too-bad/"/>
    <updated>2009-06-05T19:00:00+02:00</updated>
    <id>http://bosko.github.io/blog/2009/06/05/still-on-cvs-too-bad</id>
    <content type="html"><![CDATA[<p>At the and of May 2009 Savannah disks crashed. You can read more about it <a href="http://lists.gnu.org/archive/html/savannah-users/2009-05/msg00023.html">here</a>. This is something no one can predict. You never know when your hardware will let you down, and there is no cure for that. Disks will be replaced, system reinstalled, backups restored and that’s it. Or is it?</p>

<p>Not completely if you are using CVS or SVN and there were some commits after the last backup. Emacs developers spent few days in the <a href="http://lists.gnu.org/archive/html/emacs-devel/2009-06/msg00056.html">discussion</a> to determine what commits they lost.</p>

<p>Luckily they had Git mirror of CVS repository but what surprises me is they didn’t move to Git yet. If they were using Git they would have been able to restore complete repository in a few minutes (maybe longer for
large repositories). Since they already have Git mirror for Emacs code I really do not understand why do they not switch to Git completely. Having full history at each developer’s computer is a huge benefit. Not
to mention that Git gives you possibilities you can only dream of in CVS and SVN.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Splitting Ruby Array]]></title>
    <link href="http://bosko.github.io/blog/2009/06/04/splitting-ruby-array/"/>
    <updated>2009-06-04T19:00:00+02:00</updated>
    <id>http://bosko.github.io/blog/2009/06/04/splitting-ruby-array</id>
    <content type="html"><![CDATA[<p>Recently I had to process arrays of data with more than thousand of members but requirement was not to process them one by one. Instead I had to split array into chunks and to process each of sub-arrays separately. I&rsquo;ve found one definition of chunk method within comments on this <a href="http://snippets.dzone.com/posts/show/3486">post</a> and I&rsquo;m including it here. This method splits array in given number of sub-arrays and I needed a version that will split array in the sub-arrays that have predefined size (ok, I know I could simply calculate a number of chunks by dividing total number of elements by required number of elements, but I just wanted one method that&rsquo;ll do all that for me). So I wrote chunk_max_num method. If maximum number of elements per array is zero or negative it will return original array and for all other cases it will return array which has arrays of given size as members.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;enumerator&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Array</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">chunk_max_num</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="k">unless</span> <span class="n">max_num</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">quot</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="n">max_num</span><span class="p">)</span>
</span><span class='line'>    <span class="n">quot</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mod</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.quot</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span><span class="o">*</span><span class="n">max_num</span><span class="p">}</span><span class="o">.</span><span class="n">enum_cons</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">|</span> <span class="n">slice</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">b</span><span class="p">)}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">chunk</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span><span class='line'>    <span class="n">q</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
</span><span class='line'>    <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.pieces</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="o">[</span><span class="n">r</span><span class="p">,</span><span class="n">i</span><span class="o">].</span><span class="n">min</span><span class="p">}</span><span class="o">.</span><span class="n">enum_cons</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">|</span> <span class="n">slice</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">b</span><span class="p">)}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Easy Emacs]]></title>
    <link href="http://bosko.github.io/blog/2009/05/20/easy-emacs/"/>
    <updated>2009-05-20T21:43:00+02:00</updated>
    <id>http://bosko.github.io/blog/2009/05/20/easy-emacs</id>
    <content type="html"><![CDATA[<h2>First step</h2>

<p>In my <a href="http://pragmaticdevnotes.wordpress.com">previous articles</a> I wrote a lot about Emacs, its customization and adjusting it for Ruby and Ruby on Rails development. Although these articles give detailed
instructions how to set everything up, following all steps are somewhat cumbersome and require quite a lot of work.</p>

<p>Fortunately there is a solution. Just clone <a href="http://github.com/technomancy/emacs-starter-kit/tree/master">Emacs starter kit</a> from Github and you will be able to develop Ruby and RoR applications in
Emacs in just a few simple steps. Emacs starter kit uses <a href="http://tromey.com/elpa/">Elpa</a> packaging and is very easy to configure. But let’s start from the beginning.</p>

<p>Clone <a href="http://github.com/technomancy/emacs-starter-kit/tree/master">Emacs starter kit</a> with
<a href="http://git-scm.com/">Git</a>, to your <strong>empty</strong> .emacs.d directory. Be sure that init.el file is in .emacs.d folder. If you do not use Git (do you realize what you are missing?) you can get archived sources if you
press <em>download</em> button on Emacs starter kit page on Github. Unpack archive to the .emacs.d and be sure that init.el is in .emacs.d folder.</p>

<p>Emacs starter kit has some packages that are still not in Elpa but you’ll have to install additional packages required for Ruby and RoR. Let’s do it now:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>M-x package-list-packages</span></code></pre></td></tr></table></div></figure>


<p>New buffer with list of available packages will open and you can select those you want to install. If you plan to use Emacs for Ruby and RoR you’ll definitely need <em>Rinari</em>. It will install all dependent packages.</p>

<p>There are few other that might come in handy like css-mode, javascript or yasnippet but you can always add them later. If you install yasnippet you should probably need <a href="http://github.com/eschulte/yasnippets-rails/tree/master">yasnippets-rails</a>, but more about that later. Installing packages is very easy. Just place
cursor on the package line and press ‘i’. When you are finished with selection press ‘x’ and packages will be installed. At any time you can press ‘h’ to get quick help for Elpa packaging system. In order to
uninstall package you have to press ‘d’ (and ‘x’ after that).</p>

<h2>Further customization</h2>

<p>When you are done with packages installation just restart Emacs and you are ready to continue work in your favorite language &ndash; Ruby and framework &ndash; Ruby on Rails :) But what if you want to adjust some
settings or keep some of those you set according to my previous articles? Luckily that is easy to do, too.</p>

<p>First create sub-directory in .emacs.d directory with your user name on the system you are using. Put your .el files there and Emacs starter kit will load them automatically during Emacs start up. If you have changed
color theme and you’ve used theme from color-theme library put color-theme-library.el in this folder and add, for example, line</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(color-theme-deep-blue)</span></code></pre></td></tr></table></div></figure>


<p>to any of .el files in this folder. I keep all my additional settings in customization.el file.</p>

<p>I already mentioned yasnippet and yasnippets-rails packages. Simplest way to install yasnippet library is from Elpa system following above mentioned procedure. Unfortunately yasnippets-rails cannot be installed that way so you should clone it from the Github:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone git://github.com/eschulte/yasnippets-rails.git
</span></code></pre></td></tr></table></div></figure>


<p>Directory yasnippets-rails should be in the directory with your user name under .emacs.d. Add following lines to your customization.el file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="o">(</span>add-to-list ’load-path<span class="se">\</span>
</span><span class='line'> <span class="o">(</span>concat dotfiles-dir “/&lt;user-name&gt;/yasnippets-rails”<span class="o">))</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span>add-hook ‘ruby-mode-hook ; or rails-minor-mode-hook ?
</span><span class='line'>’<span class="o">(</span>lambda <span class="o">()</span>
</span><span class='line'> <span class="o">(</span>make-variable-buffer-local ’yas/trigger-key<span class="o">)</span>
</span><span class='line'> <span class="o">(</span>setq yas/trigger-key <span class="o">[</span>tab<span class="o">])))</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span>require ’yasnippet<span class="o">)</span>
</span><span class='line'><span class="o">(</span>add-to-list ’yas/extra-mode-hooks
</span><span class='line'> ’ruby-mode-hook<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span>yas/initialize<span class="o">)</span>
</span><span class='line'><span class="o">(</span>setq yas/window-system-popup-function ’yas/x-popup-menu-for-template<span class="o">)</span>
</span><span class='line'><span class="o">(</span>yas/load-directory <span class="o">(</span>concat dotfiles-dir
</span><span class='line'>“/&lt;user-name&gt;/yasnippet/snippets”<span class="o">))</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span>yas/load-directory
</span><span class='line'> <span class="o">(</span>concat
</span><span class='line'> dotfiles-dir “/&lt;user-name&gt;/yasnippets-rails/rails-snippets/”<span class="o">))</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span>make-variable-buffer-local ’yas/trigger-key<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>and you will be ready for using new snippets during development.</p>

<h2>Final word</h2>

<p>My previous articles were based on Rails reloaded package for RoR development in Emacs. It is good library and if you like fancy GUI things you can still use it. There is a <a href="http://github.com/dima-exe/emacs-rails-reloaded/tree/master">new version</a> on Github.</p>

<p>Still, I would recommend trying Rinari that is a package from Elpa. It doesn’t have any GUI features but once your fingers “learn” all shortcuts your RoR development will be much easier and faster.</p>
]]></content>
  </entry>
  
</feed>
